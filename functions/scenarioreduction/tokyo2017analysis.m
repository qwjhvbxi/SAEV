
load('../data/JEPXSpot2017.mat'); % spot2017 variable

% area price:
figure
plot(spot2017(:,6:14)) % area prices
figure
plot(spot2017(:,8)) % tokyo area prices

%time code (1-48) [1]           ?????,
%quantities [2:4]               ?????(kWh),?????(kWh),????(kWh),
%system price [5]               ????????(?/kWh),
%area prices [6:14]             ??????????(?/kWh),?????????(?/kWh),?????????(?/kWh),?????????(?/kWh),?????????(?/kWh),?????????(?/kWh),?????????(?/kWh),?????????(?/kWh),?????????(?/kWh),NaN,
%spot price (intraday) [16:20]  ????????????(?/kWh),????×????????????(?/kWh),????×????????????(?/kWh),????×????????????(?/kWh),????×????????????(?/kWh),NaN,
%avoidable price ?? [22:31]     ?????????(?/kWh),?????????(?/kWh),????????(?/kWh),????????(?/kWh),????????(?/kWh),????????(?/kWh),????????(?/kWh),????????(?/kWh),????????(?/kWh),????????(?/kWh)


% create scenarios
x=reshape(spot2017(:,8),48,365);

[u,r,d,e,C]=scenarioreduction(x);

save('../data/TokyoDayaheadFY2017scenarioReduced.mat','u','r','d','e','C','x');


%% plots/checks

% 20 most common profiles and probabilities
[u(1:20) r(1:20,20)]

% most common profile plotted
figure
stairs(x(:,u(1)))

% most common 100 profiles without outliers (representing only 1 or 2 days, etc.)
limite=0;%1/365;
nooutliers=(r(1:100,1:100)>limite);
sum(nooutliers) % 28
plot(sum(nooutliers))

% panel view of the most common profiles
imax=4;
jmax=5;
plotind=1;
totscenarios=20;%28;
figure
for j=1:totscenarios
    if r(j,totscenarios)>limite
        subplot(imax,jmax,plotind)
        stairs(x(:,u(j)))
        xlim([1,24])
        % ylim([0 60])
        title(num2str(r(j,totscenarios)))
        plotind=plotind+1;
    end
end

figure
for i=1:100
    
    plot(r(1:100,i))
    axis([1,100,0,1])
    drawnow
    pause(0.2)
    
end

% weighted variance of profiles
mean(var(x(:,u(1:20)))'.*r(1:20,20))








